<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>赛事</title>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,target-densitydpi=medium-dpi">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/m_style.css" />
    <link rel="stylesheet" href="../css/mobileSelect.css" />
</head>

<body>
    <div class="dove_event_box">
        <!--搜索栏-->
        <div class="loft_search clearfix">
            <div class="loft_search_l">
                <span id="trigger1">赛事</span>
                <img src="../image/gp.png">
            </div>
            <div class="loft_search_r">
                <input class="searchWord" type="text" placeholder="唐山天翼盛翔赛鸽公棚">
                <img src="../image/search_gp.png">
            </div>
        </div>
        <!--导航-->
        <div class="navigation_box">
            <ul class="navigation clearfix" id="nav_box">
                <li class="active">
                    <div class="new_release_r">最新发布</div>
                    <div class="el_but" id="new_updown">
                        <img src="../image/sj_icon0.png" alt="">
                    </div>
                </li>
                <li>
                    <div class="new_release_r">人气</div>
                    <div class="el_but" id="follow_updown">
                        <img src="../image/sj_icon0.png" alt="">
                    </div>
                </li>
            </ul>
            <p class="line_red"></p>
        </div>
        <!--赛事列表-->
        <ul class="dove_event_con" id="match_list_box">
            <!-- <li class="clearfix">
                <div class="dove_event_conl">
                    <p class="clearfix dove_event_t">
                        <span class="dove_event_in">7月</span>
                        <span class="dove_event_day">12</span>
                    </p>
                    <p class="dove_event_time clearfix">
                        <span class="dove_event_timel">止</span>
                        <span class="dove_event_timer">2017-07-22</span>
                    </p>

                </div>
                <div class="dove_event_conr">
                    <p class="dove_event_n">西安为期公棚第十三届“西部之巅”赛鸽峰会</p>
                    <p class="dove_event_b">报名中</p>
                    <p class="dove_event_g">唐山公棚盛意赛鸽公棚</p>
                    <div class="dove_event_p clearfix">
                        <img src="../image/mon.png">
                        <p>
                            总奖金<span>500</span>万元
                        </p>
                    </div>
                    <img src="../image/s_round.png" alt="" class="dove_event_conr1">
                </div>
            </li> -->
        </ul>
        <!--上拉加载更多-->
        <div class="load_more" style="padding:0.5rem 0">
            <img src="../image/load.gif" alt="" style="display:none; top:.3rem;">
            <span id="load_more_txt">上拉加载更多</span>
        </div>
        <!--tab栏-->
        <footer class="in_foot">
            <ul>
                <li class="j_index">
                    <img src="../image/header.png" alt="">
                    <p>首页</p>
                </li>
                <li class="j_breeding">
                    <img src="../image/dove.png" alt="">
                    <p>种鸽</p>
                </li>
                <li class="in_foot_type">
                    <img src="../image/classification2.png" alt="">
                    <p style="color:#ff0913">分类</p>
                </li>
                <li class="in_foot_me">
                    <img src="../image/me2.png" alt="">
                    <p>我的</p>
                </li>
            </ul>
        </footer>
    </div>
    <script type="text/javascript" src="../js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="../js/public.js"></script>
    <script type="text/javascript" src="../js/weixin_init.js"></script>
    <script type="text/javascript" src="../js/mobileSelect.min.js"></script>
    <script type="text/javascript" src="../json/indexJson.js"></script>
    <script type="text/javascript" src="../js/all_match_list.js"></script>
    <script>
        $(function() {
            // 注： orderBy可选字段： createdTime添加时间， publishedTime添加时间， updatedTime修改时间， views浏览量， sales销量， follows关注量
            var postMatchData = {
                "keyword": "", //检索关键字
                "pageSize": "5", //分页参数：分页大小
                "pageNum": 1, //分页参数：页码
                "orderBy": "publishedTime",
                "orderDesc": "" //分页参数：升降序标记，desc为降序，不传或空字符串为升序
            }
            matchListObj.initMatchQuest(postMatchData); //页面初始化

            /*------------------------------点击事件--------------------*/
            //屏幕滚动事件
            $(window).on("scroll", function() {
                var scrolT = $(document).scrollTop(); //滚动距离
                var clientH = $(window).height(); //视口高度
                var allH = $(document).height(); //整个文档高度
                if (allH - clientH <= scrolT && scrolT > 20) {
                    if (scrollFlag) {
                        scrollFlag = false;
                        $(".load_more img").show();
                        $("#load_more_txt").html("加载中...")
                        postMatchData.orderBy = $("#nav_box .active").index() == 0 ? "publishedTime" : "follows"; //关注量
                        postMatchData.pageNum += 1; //页码


                        setTimeout(function() {
                            matchListObj.initMatchQuest(postMatchData);
                            $(document).scrollTop(scrolT - 10);
                        }, 1500)
                    }
                }
            });

            $(".loft_search_r img").click(function(){
                var keyword = $(".searchWord").val();
                var postMatchData = {
                    "keyword": keyword, //检索关键字
                    "pageSize": "5", //分页参数：分页大小
                    "pageNum": 1, //分页参数：页码
                    "orderBy": "publishedTime",
                    "orderDesc": "" //分页参数：升降序标记，desc为降序，不传或空字符串为升序
                }
                matchListObj.initMatchQuest(postMatchData); //页面初始化
            });

            //点击 最新发布 、人气
            var lineL = parseFloat($(".line_red").css("left"));
            console.log(lineL)
            $("#nav_box li").on("click", function() {
                var _index = $(this).index();
                $("#nav_box li").removeClass("active");
                $(this).addClass("active");
                switch (_index) {
                    case 0:
                        console.log(lineL)
                        $(".line_red").css({
                            "left": (lineL + $(".line_red").width() / 2) + "px",
                            "transition": "left 0.3s"
                        });
                        matchListStr = ""; //默认清空，重新渲染列表数据
                        $("#match_list_box").html("");
                        postMatchData.orderBy = "publishedTime";
                        break;
                    case 1:
                        var L = $("#nav_box li").eq(0).width() + $(".line_red").width() + lineL / 3;
                        $(".line_red").css({
                            "left": L + "px",
                            "transition": "left 0.3s"
                        });
                        matchListStr = ""; //默认清空，重新渲染列表数据
                        $("#match_list_box").html("");
                        postMatchData.orderBy = "follows";
                }
                matchListStr = ""; //默认清空，重新渲染列表数据
                $("#match_list_box").html("")
                postMatchData.pageNum = 1;
                matchListObj.initMatchQuest(postMatchData); //调接口
            });
            //点击 “最新发布” 排序
            //默认升序
            var newUpFlag = true;
            $("#new_updown img").on("click", function(ev) {
                ev.stopPropagation();
                newUpFlag = !newUpFlag;
                var upImg = newUpFlag ? "../image/sj_icon0.png" : "../image/sj_icon.png";
                $(this).attr("src", upImg);

                //调接口
                matchListStr = ""; //默认清空，重新渲染列表数据
                $("#match_list_box").html("")
                postMatchData.orderDesc = newUpFlag ? "" : "desc";
                postMatchData.orderBy = "publishedTime";
                postMatchData.pageNum = 1;
                matchListObj.initMatchQuest(postMatchData);
            });
            //点击 “人气” 排序
            var followUpFlag = true;
            $("#follow_updown img").on("click", function(ev) {
                ev.stopPropagation();
                followUpFlag = !followUpFlag;
                var upImg = followUpFlag ? "../image/sj_icon0.png" : "../image/sj_icon.png";
                $(this).attr("src", upImg);
                //调接口
                matchListStr = ""; //默认清空，重新渲染列表数据
                $("#match_list_box").html("")
                postMatchData.orderDesc = followUpFlag ? "" : "desc";
                postMatchData.orderBy = "follows";
                postMatchData.pageNum = 1;
                matchListObj.initMatchQuest(postMatchData);
            });

            //底部服务条 跳转
            $(".j_index").on("click", function() { //首页
                location.href = "../index.html?openid=" + openid;
            });
            $(".j_breeding").on("click", function() { //种鸽
                location.href = "business_list.html?openid=" + openid;
            });
            $(".in_foot_me").on("click", function() { //我的
                location.href = "mine.html?openid=" + openid;
            });

            /*跳转赛事详情*/
            $("#match_list_box").on("click", "li", function() {
                var raceid = $(this).attr("raceId");
                location.href = "match_details.html?openid=" + openid + "&raceid=" + raceid;
            });
            //插件
            var mobileSelect1 = new MobileSelect({
                trigger: '#trigger1',
                title: '',
                wheels: [{
                    data: ["赛事",
                        "公棚"
                    ]
                }],
                position: [0], //初始化定位 打开时默认选中的哪个 如果不填默认为0
                transitionEnd: function(indexArr, data) {},
                callback: function(indexArr, data) {
                    if (data == "公棚") {
                        this.innerHtml = "赛事";
                        location.href = "all_loft_list.html?openid=" + openid;
                    }
                }
            });
        });
    </script>
</body>

</html>
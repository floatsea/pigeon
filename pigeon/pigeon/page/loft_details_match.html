<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>公棚赛事</title>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,target-densitydpi=medium-dpi">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/loft_about.css">
    <script type="text/javascript" src="../js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="../js/public.js"></script>
    <script type="text/javascript" src="../js/weixin_init.js"></script>
    <style lang="">

    </style>
</head>

<body>
    <div class="loft_match_box" id="match_list_box">
        <h3>公棚赛事</h3>
        <ul>
            <li>
                <p class="">
                    国际赛鸽中心2018年第八届“五龙杯”汽车争霸赛&nbsp
                    <span>报名中</span>
                </p>
                <div class="clearfix">
                    <button class="look_match_btn">查看比赛章程</button>
                    <button class="sign_up">报名</button>
                </div>
            </li>
            <li>
                <p class="">
                    国际赛鸽中心2018年第八届“五龙杯”汽车争霸赛&nbsp
                    <span>报名中</span>
                </p>
                <div class="clearfix">
                    <button class="look_match_btn">查看比赛章程</button>
                    <button class="sign_up">报名</button>
                </div>
            </li>
            <li>
                <p class="">
                    国际赛鸽中心2018年第八届“五龙杯”汽车争霸赛&nbsp
                    <span>报名中</span>
                </p>
                <div class="clearfix">
                    <button class="look_match_btn">查看比赛章程</button>
                    <button class="sign_up">报名</button>
                </div>
            </li>
        </ul>
        <!--上拉加载更多-->
        <div class="load_more">
            <img src="../image/load.gif" alt="" style="display:none;">
            <span id="load_more_txt">上拉加载更多</span>
        </div>
    </div>
    <script>
        /*
         *后端没有提供接口
         */
        var openid = getParameter("openid") || "";
        var oneloftid = getParameter("oneloftid") || ""; //公棚id
        var scrollFlag = true; //上拉加载更多标志
        var postMatchData = {
            "publisher_id": oneloftid, //商家id或公棚id
            "news_type": "oneloft", //消息类型：商家，business；公棚oneloft"
            "pageSize": "6",
            "pageNum": "1"
        };
        getLoftMatch(postMatchData);
        //公棚资讯列表
        function getLoftMatch(postMatchData) {
            $.ajax({
                url: location.origin + "/customer/race/findList",
                type: "post",
                data: JSON.stringify(postMatchData),
                dataType: "json",
                contentType: "application/json",
                success: function(data) {
                    
                    if (data.code == "0") {
                        var list = data.data.list;
                        createLoftMatch(list);
                        if (!scrollFlag) {
                            $(".load_more img").hide();
                            $("#load_more_txt").html("没有更多数据");
                        } else {
                            $(".load_more img").hide();
                            $("#load_more_txt").html("上拉加载更多");
                        }
                    }
                },
                error: function() {
                    myAlert.createBox("服务器开小差！")
                }
            })
        }
        //创建公棚列表
        function createLoftMatch(list) {
            var matchStr = "";
            list.forEach(function(val) {
                matchStr += '<li>' +
                    '<p class="">' +
                    '国际赛鸽中心2018年第八届“五龙杯”汽车争霸赛&nbsp' +
                    '<span>报名中</span>' +
                    '</p>' +
                    '<div class="clearfix">' +
                    '<button class="look_match_btn">查看比赛章程</button>' +
                    '<button class="sign_up">报名</button>' +
                    '</div>' +
                    '</li>';
            });
            $("#match_list_box").html(matchStr);
        }
        //滚动事件
        $(window).on("scroll", function() {
            var scrolT = $(document).scrollTop(); //滚动距离
            var clientH = $(window).height(); //视口高度
            var allH = $(document).height(); //整个文档高度
            if (allH - clientH <= scrolT && scrolT > 20) {
                if (scrollFlag) {
                    scrollFlag = false;
                    $(".load_more img").show();
                    $("#load_more_txt").html("加载中...");
                    postMatchData.pageNum += 1; //页码
                    setTimeout(function() {
                        getLoftMatch(postMatchData);
                        $(document).scrollTop(scrolT - 10);
                    }, 1500);
                }
            }
        });
    </script>
</body>

</html>
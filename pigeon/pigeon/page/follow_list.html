<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>我的关注</title>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,target-densitydpi=medium-dpi">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/m_style.css" />
    <link rel="stylesheet" href="../dist/idangerous.swiper.css">
</head>

<body>
    <div class="my_collection_box">
        <!--标题-->
        <div class="follow_tit">
            <ul>
                <li class="active">商品</li>
                <li>公棚</li>
            </ul>
            <i class="follow_line"></i>
        </div>
        <!--列表-->
        <div class="follow_list_box">
            <!--种鸽-->
            <ul class="list_images my_collection" id="my_collection">
                <li class="list_images_n">
                    <div class="list_cont clearfix">
                        <div class="list_images_l">
                            <img src="../image/list_img.png">
                        </div>
                        <div class="list_images_r">
                            <p class="list_images_rn">白明星<span>DV0176-18-27</span></p>
                            <p class="list_images_rl">最佳种鸽做育幼鸽</p>
                            <p class="dove_price1"><span>&yen</span>39999.00</p>
                            <div class="seller1">
                                <img src="../image/dinw.jpg" />
                                <p>卖家：Andreas Drapa</p>
                            </div>
                        </div>
                    </div>
                    <div class="collect_cancel_btn">
                        <span>取消收藏</span>
                    </div>
                </li>
            </ul>
            <!--公棚-->
            <ul class="att_box_con" style="display:none;" id="loft_box">
                <li>
                    <h3>
                        华顺德春棚2018年7月8日收鸽数据
                        <img src="../image/vi.png" alt="" class="vedio_btn">
                    </h3>
                    <p>
                        <span>华顺德春棚</span>
                        <span>2018-07-07 15:30:26</span>
                    </p>
                </li>
            </ul>
        </div>
        <!--上拉加载更多-->
        <div class="load_more">
            <img src="../image/load.gif" alt="" style="display:none;">
            <span id="load_more_txt">上拉加载更多</span>
        </div>
    </div>
    <script type="text/javascript" src="../js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="../js/public.js"></script>
    <script type="text/javascript" src="../js/weixin_init.js"></script>
    <script src="../dist/idangerous.swiper.min.js"></script>
    <script src="../json/indexJson.js"></script>
    <script src="../js/follow_list.js"></script>
    <script>
        var openid = getParameter("openid");
        var tabnum = getParameter("tabnum"); //0：商品， 1：公棚
        var followData = {
            "followType": 1,
            "pageSize": "10",
            "pageNum": "1"
        };
        followData.followType = (tabnum == 0) ? 1 : 3;
        //商品列表 左右滑动
        var listBox = document.querySelector("#my_collection");
        followListObj.setMove(listBox);
        //初始化 tab底部线条位置
        var lineW = $(".follow_line").width();
        var liW = $(".follow_tit li").eq(0).width();
        var l = (liW - lineW - 6) / 2
        $(".follow_line").css({
            "left": l + "px"
        });
        //切换 “商品” 和 “公棚” 选项
        $(".follow_tit li").on("click", function() {
            $(".follow_tit li").removeClass("active");
            $(this).addClass("active");
            var _index = $(this).index();
            $(".follow_line").css({
                "left": (l + liW * _index) + "px"
            });
            $(".follow_list_box ul").html(""); //清空所有列表数据
            followData.pageNum = 1; //每次切换都从第一页开始查询
            followData.followType = (_index == 0) ? 4 : 2;

            reloadToken({
                "Authorization": Authorization
            }, {
                "openid": openid
            }, function() {
                Authorization = localStorage.getItem("Authorization") || "";
                followListObj.initPageListRequest(followData);
            });
            $(".follow_list_box ul").hide();
            $(".follow_list_box ul").eq(_index).show();
        });
        // tabnum ：0 商品 ，  1：关注全部动态跳过来的
        $(".follow_tit li").eq(tabnum).trigger("click");

        //上拉加载更多
        $(window).on("scroll", function() {
            var scrolT = $(document).scrollTop(); //滚动距离
            var clientH = $(window).height(); //视口高度
            var allH = $(document).height(); //整个文档高度
            if (allH - clientH <= scrolT && scrolT > 20) {
                if (scrollFlag) {
                    scrollFlag = false;
                    $(".load_more img").show();
                    $("#load_more_txt").html("加载中...");
                    followData.pageNum += 1; //页码
                    setTimeout(function() {
                        followListObj.initPageListRequest(followData); //再次调用
                        $(document).scrollTop(scrolT - 10);
                    }, 1500);
                }
            }
        });
    </script>
</body>

</html>
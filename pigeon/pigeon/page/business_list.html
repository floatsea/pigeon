<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>种鸽</title>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,target-densitydpi=medium-dpi">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/m_style.css" />
</head>

<body>
    <div class="breeding_box">
        <!--搜索栏-->
        <div class="search">
            <input type="text" placeholder="最佳种鸽做玉" id="serch_txt">
            <img src="../image/search_gp.png">
        </div>
        <div class="navigation_box">
            <ul class="navigation clearfix" id="list_btn">
                <li class="active">
                    <div class="new_release_r">
                        最新发布
                    </div>
                    <div class="el_but" id="new_updown">
                        <img src="../image/sj_icon0.png" alt="">
                    </div>
                </li>
                <li>
                    <div class="new_release_r">人气</div>
                    <div class="el_but" id="follow_updown">
                        <img src="../image/sj_icon0.png" alt="">
                    </div>
                </li>
            </ul>
            <p class="line_red"></p>
        </div>
        <!--种鸽店面-->
        <div class="breeding_pigeons_box" id="list_box">
            <!-- <div class="breeding_pigeons">
                <div class="breeding_pigeons_n">
                    <img src="../image/gp_pic.png">
                    <p>7羽幼正在热卖 ¥408起</p>
                </div>
                <ul class="breeding_pigeons_m clearfix">
                    <li class="breeding_pigeons_name">
                        <p class="breeding_pigeons_names">比利时~野了.龙吉尔</p>
                        <p class="breeding_pigeons_namex">最佳种鸽做育幼鸽</p>
                    </li>
                    <li class="breeding_pigeons_price">
                        <p class="breeding_pigeons_go">
                            <a href="list_view.html">进店逛逛</a>
                        </p>
                    </li>
                </ul>
            </div> -->
        </div>
        <!--上拉加载更多-->
        <div class="load_more">
            <img src="../image/load.gif" alt="" style="display:none;">
            <span id="load_more_txt">上拉加载更多</span>
        </div>
        <!--tab栏-->
        <footer class="in_foot">
            <ul>
                <li class="j_index">
                    <img src="../image/header.png" alt="">
                    <p>首页</p>
                </li>
                <li>
                    <img src="../image/dove2.png" alt="">
                    <p style="color:#ff0913">种鸽</p>
                </li>
                <li class="in_foot_type">
                    <img src="../image/classification.png" alt="">
                    <p>分类</p>
                </li>
                <li class="in_foot_me">
                    <img src="../image/me2.png" alt="">
                    <p>我的</p>
                </li>
            </ul>
        </footer>
    </div>
    <script type="text/javascript" src="../js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="../js/public.js"></script>
    <script type="text/javascript" src="../js/weixin_init.js"></script>
    <script type="text/javascript" src="../json/indexJson.js"></script>
    <script type="text/javascript" src="../js/business_list.js"></script>
    <script>
        $(function() {
            //页面初始化，默认按发布顺序排序
            //注：orderBy可选字段：createdTime添加时间，publishedTime添加时间，updatedTime修改时间，views浏览量，sales销量，follows关注量.
            var businessData = {
                "keyword": $("#serch_txt").val(),
                "pageSize": 10,
                "pageNum": 1,
                "orderBy": "publishedTime",
                "orderDesc": "" //分页参数：升降序标记，desc为降序，不传或空字符串为升序
            }
            businessObj.initPageQuery(businessData);

            /*点击事件*/
            $(".j_index").on("click", function() { //首页
                location.href = "../index.html?openid=" + openid;
            });
            $(".in_foot_type").on("click", function() { //分类
                location.href = "all_match_list.html?openid=" + openid;
            });
            $(".in_foot_me").on("click", function() { //我的
                location.href = "mine.html?openid=" + openid;
            });

            //点击查询方式 （最新发布、人气）
            var lineL = parseInt($(".line_red").css("left")); //按钮下划线 页面初始化的位置 
            $("#list_btn li>div").on("click", function() {
                var _index = $(this).closest("li").index();
                $("#list_btn li").removeClass("active");
                $(this).closest("li").addClass("active");
                var lineW = $(".line_red").width();
                $(".line_red").css("transition", "left 0.5s")
                if (_index == 1) {
                    var liW = $("#list_btn li").eq(0).width();
                    $(".line_red").css("left", (lineW * 1.5 + liW + 3) + "px")
                } else {
                    $(".line_red").css("left", (lineL + 10) + "px")
                }
                //调接口
                businessListStr = "";
                $("#list_box").html(businessListStr);
                businessData.keyword = $("#serch_txt").val();
                businessData.pageNum = 1;
                businessData.orderBy = _index == 0 ? "publishedTime" : "follows";
                businessObj.initPageQuery(businessData);
            });

            //点击 最新发布 升序降序
            //默认升序
            var newUpFlag = true;
            $("#new_updown img").on("click", function(ev) {
                ev.stopPropagation();
                newUpFlag = !newUpFlag;
                var upImg = newUpFlag ? "../image/sj_icon0.png" : "../image/sj_icon.png";
                $(this).attr("src", upImg);
                //调接口
                businessListStr = "";
                $("#list_box").html("");
                businessData.orderDesc = newUpFlag ? "" : "desc";
                businessData.orderBy = "publishedTime";
                businessObj.initPageQuery(businessData);
            });

            //点击 人气 升序降序
            var followUpFlag = true;
            $("#follow_updown img").on("click", function(ev) {
                ev.stopPropagation();
                followUpFlag = !followUpFlag;
                var upImg = followUpFlag ? "../image/sj_icon0.png" : "../image/sj_icon.png";
                $(this).attr("src", upImg);

                //调接口
                businessListStr = "";
                $("#list_box").html("");
                businessData.orderDesc = followUpFlag ? "" : "desc";
                businessData.orderBy = "follows"; //关注量
                businessObj.initPageQuery(businessData);
            });
            // var scrollFlag = true;
            $(window).on("scroll", function() {
                var scrolT = $(document).scrollTop(); //滚动距离
                var clientH = $(window).height(); //视口高度
                var allH = $(document).height(); //整个文档高度
                if (allH - clientH <= scrolT && scrolT > 20) {
                    if (scrollFlag) {
                        scrollFlag = false;
                        $(".load_more img").show();
                        $("#load_more_txt").html("加载中...");
                        businessData.orderBy = $("#list_btn .active").index() == 0 ? "publishedTime" : "follows"; //关注量
                        businessData.pageNum += 1; //页码
                        setTimeout(function() {
                            businessObj.initPageQuery(businessData);
                            $(document).scrollTop(scrolT - 10);
                        }, 1500);
                    }
                }
            });
        })
    </script>
</body>

</html>
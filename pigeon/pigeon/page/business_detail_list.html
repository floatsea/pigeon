<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>赛鸽</title>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,target-densitydpi=medium-dpi">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/m_style.css" />
    <link rel="stylesheet" href="../dist/idangerous.swiper.css">
</head>

<body>
    <div class="list_view_bg">
        <!--banner-->
        <section class="info_banner release_banner">
            <!--搜索栏-->
            <div class="search">
                <form id="searchForm" action="">
                    <input type="search" autocomplete="off" placeholder="最佳种鸽做玉" id="serch_txt">
                </form>
                <img src="../image/search_gp.png">
            </div>
            <div class="device">
                <div class="swiper-container">
                    <div class="swiper-wrapper" id="swiper_box">
                        <!-- <div class="swiper-slide">
                            <img src="../image/list_banner.png" alt="" />
                        </div>-->
                    </div>
                </div>
                <div class="swiper-pagination clearfix"></div>
            </div>
            <div class="device_tit" id="banner_tit">
                <h5>比利时~耶乐.隆吉尔</h5>
                <p>最佳种鸽作育幼鸽</p>
                <i id="business_introduce">商家简介</i>
            </div>
        </section>
        <!--商家动态-->
        <section class="dynamics_box">
            <div style="height:100%;">
                <img src="../image/sjdt.png" alt="">
            </div>
            <div id="msg_box" class="msg_box">
                <!-- <img src="../image/sjdt.png" alt="">
                        <p>参加巴塞罗那有奖竞猜活动，赢取“新新新新…</p>
                        <i>2018-03-17</i> -->
            </div>
            
        </section>
        <section class="navigation_box2 clearfix">
            <ul class="navigation2 clearfix" id="nav_box">
                <li class="active">
                    <div class="new_release_r">最新发布</div>
                    <div class="el_but" id="new_updown">
                        <img src="../image/sj_icon0.png" alt="">
                    </div>
                </li>
                <li>
                    <div class="new_release_r">人气</div>
                    <div class="el_but" id="follow_updown">
                        <img src="../image/sj_icon0.png" alt="">
                    </div>
                </li>
            </ul>
            <ul style="margin-left: 1.5rem;">
                <li class="shaixuan_btn">
                    <div class="new_release_r">筛选</div>
                    <div class="el_but sx">
                        <img src="../image/sx.png" alt="">
                    </div>
                </li>
            </ul>
            <p class="line_red"></p>
            <ul>
                <li class="an_but">
                    <img src="../image/an_but.png">
                </li>
                <li class="hs" id="release_btn">
                    <img src="../image/hs.png">
                </li>
            </ul>
        </section>
        <!--列表-->
        <ul class="list_images list_view_box" id="list_view_box">
            <!-- <li class="list_images_n clearfix">
                <div class="list_images_l">
                    <img src="../image/list_img.png" height="171" width="182">
                </div>
                <div class="list_images_r">
                    <p class="list_images_rn">白明星<span>DV0176-18-27</span></p>
                    <p class="list_images_rl">最佳种鸽做育幼鸽</p>
                    <p class="dove_price1"><span>&yen</span>39999.00</p>
                    <div class="seller1">
                        <img src="../image/dinw.jpg" />
                        <p>卖家：Andreas Drapa</p>
                    </div>
                </div>
            </li> -->
        </ul>
        <!--上拉加载更多-->
        <div class="load_more" style="padding:0.5rem 0">
            <img src="../image/load.gif" alt="" style="display:none; top:.3rem;">
            <span id="load_more_txt">上拉加载更多</span>
        </div>
        <!--tab栏-->
        <footer class="in_foot">
            <ul>
                <li class="j_index">
                    <img src="../image/header.png" alt="">
                    <p>首页</p>
                </li>
                <li class="">
                    <img src="../image/dove2.png" alt="">
                    <p style="color:#ff0913">种鸽</p>
                </li>
                <li class="in_foot_type">
                    <img src="../image/classification.png" alt="">
                    <p>分类</p>
                </li>
                <li class="in_foot_me">
                    <img src="../image/me2.png" alt="">
                    <p>我的</p>
                </li>
            </ul>
        </footer>
    </div>
    <!--筛选弹窗-->
    <div class="bg"></div>
    <div class="SX_mark clearfix" style="background: rgba(0,0,0,0);width:84%;    z-index: 12;">
        <!-- <div class="SX_left"></div> -->

        <div class="SX_box" style="width:100%;">
            <ul>
                <li>
                    <h5>按血统</h5>
                    <div class="pigeon_tag ancestry clearfix">
                        <span class="active">白雪公主</span>
                        <!-- <span>血统</span>
                        <span>出单中</span> -->
                    </div>
                </li>
                <li>
                    <h5>按距离</h5>
                    <div class="pigeon_tag distance clearfix">
                        <span>短</span>
                        <span>中</span>
                        <span>长</span>
                    </div>
                </li>
                <li>
                    <h5>按特性</h5>
                    <div class="pigeon_tag features clearfix">
                        <span>适合雨天</span>
                        <span>适合晴天</span>
                        <span>耐热</span>
                    </div>
                </li>
            </ul>
            <div class="SX_btn">
                <span id="repeat_btn">重置</span>
                <span id="SX_sure_btn">确定</span>
            </div>
        </div>
    </div>
    
    <script type="text/javascript" src="../js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="../js/public.js"></script>
    <script type="text/javascript" src="../js/weixin_init.js"></script>
    <script src="../dist/idangerous.swiper.min.js"></script>
    <script src="../json/indexJson.js"></script>
    <script src="../js/business_detail_list.js"></script>
    <script>
        $(function() {
            var pigeonPostData = { //请求鸽子列表入参
                "businessId": businessid,
                "pigeonTags": "", //标签，多个标签逗号分隔
                "keyword": "", //
                "pageSize": "5", //分页参数：分页大小
                "pageNum": 1, //分页参数：页码
                "orderBy": "publishedTime", //分页参数：排序标记，以此字段排序   createdTime添加时间，publishedTime添加时间，updatedTime修改时间，views浏览量，sales销量，follows关注量.
                "orderDesc": "" //分页参数：升降序标记，desc为降序，不传或空字符串为升序
            }
            businessDetailObj.getSwiperData(businessid); //轮播图初始化
            businessDetailObj.getPigeonData(pigeonPostData, "list"); //鸽子列表初始化
            businessDetailObj.findSiteConfig();//获取筛选条件
            /*--------------------------点击事件--------------------------*/
            //切换 “最新发布” 和 “人气”
            var pL = parseFloat($(".navigation_box2").css("padding-left"));
            var lineL = parseFloat($(".line_red").css("left"));
            var W0 = $("#nav_box li").eq(0).width();
            var W1 = $("#nav_box li").eq(1).width();
            var W2 = $("#nav_box li").eq(2).width();
            $("#nav_box li").on("click", function() {
                $("#nav_box li").removeClass("active");
                $(this).addClass("active");
                var _index = $(this).index();
                $(".line_red").css("transition", "left 0.5s");
                switch (_index) {
                    case 0:
                        $(".line_red").css("left", lineL + pL / 2 + "px");
                        pigeonPostData.orderBy = "publishedTime";
                        break;
                    case 1:
                        $(".line_red").css("left", lineL + W0 + pL / 2 + "px")
                        pigeonPostData.orderBy = "follows";
                        break;
                }
                pigeonPostData.pageNum = 1;
                pigeonStr = ""; //默认清空，重新渲染列表数据
                $("#list_view_box").html("");
                businessDetailObj.getPigeonData(pigeonPostData, "list");
            });

            $('#searchForm').on('submit', function (event) {
                event.preventDefault();
                $("#list_box").html("");
                var keyword = $("#serch_txt").val();
                var orderBy = $("#nav_box .active").index() == 0 ? "publishedTime" : "follows";
                var flag = orderBy=="publishedTime"?newUpFlag:followUpFlag;
                var pigeonPostData = { //请求鸽子列表入参
                    "businessId": businessid,
                    "pigeonTags": "", //标签，多个标签逗号分隔
                    "keyword": keyword, //
                    "pageSize": "5", //分页参数：分页大小
                    "pageNum": 1, //分页参数：页码
                    "orderBy": orderBy, //分页参数：排序标记，以此字段排序   createdTime添加时间，publishedTime添加时间，updatedTime修改时间，views浏览量，sales销量，follows关注量.
                    "orderDesc": flag ? "" : "desc" //分页参数：升降序标记，desc为降序，不传或空字符串为升序
                }
                businessDetailObj.getPigeonData(pigeonPostData, "list"); //鸽子列表初始化
                $("#serch_txt").blur();
            });

            //点击 最新发布 升序降序
            //默认升序
            var newUpFlag = true;
            $("#new_updown img").on("click", function(ev) {
                ev.stopPropagation();
                newUpFlag = !newUpFlag;
                var upImg = newUpFlag ? "../image/sj_icon0.png" : "../image/sj_icon.png";
                $(this).attr("src", upImg);

                //调接口
                pigeonStr = ""; //默认清空，重新渲染列表数据
                $("#list_view_box").html("");
                pigeonPostData.orderDesc = newUpFlag ? "" : "desc";
                pigeonPostData.orderBy = "publishedTime";
                pigeonPostData.pageNum = 1;
                businessDetailObj.getPigeonData(pigeonPostData, "list");
            });
            //点击 人气 升序降序
            var followUpFlag = true;
            $("#follow_updown img").on("click", function(ev) {
                ev.stopPropagation();
                followUpFlag = !followUpFlag;
                var upImg = followUpFlag ? "../image/sj_icon0.png" : "../image/sj_icon.png";
                $(this).attr("src", upImg);

                //调接口
                pigeonStr = ""; //默认清空，重新渲染列表数据
                $("#list_view_box").html("");
                pigeonPostData.orderDesc = followUpFlag ? "" : "desc";
                pigeonPostData.orderBy = "follows"; //关注量
                pigeonPostData.pageNum = 1;
                businessDetailObj.getPigeonData(pigeonPostData, "list");
            });
            //屏幕滚动事件
            $(window).on("scroll", function() {
                var scrolT = $(document).scrollTop(); //滚动距离
                var clientH = $(window).height(); //视口高度
                var allH = $(document).height(); //整个文档高度
                if (allH - clientH <= scrolT && scrolT > 20) {
                    if (scrollFlag) {
                        scrollFlag = false;
                        $(".load_more img").show();
                        $("#load_more_txt").html("加载中...")
                        pigeonPostData.orderBy = $("#nav_box .active").index() == 0 ? "publishedTime" : "follows"; //关注量
                        pigeonPostData.pageNum += 1; //页码
                        setTimeout(function() {
                            businessDetailObj.getPigeonData(pigeonPostData, "list");
                            $(document).scrollTop(scrolT - 10);
                        }, 1500)
                    }
                }
            });
            //点击筛选 显示
            $(".shaixuan_btn").on("click", function() {
                $(".SX_mark").css("transform", "translateX(-100%)");
                $(".bg").show();
            });
            //点击每一个鸽子标签
            $(".ancestry span").on("click", function() { //血统
                businessDetailObj.getScreen($(this));
            });
            $(".distance span").on("click", function() { //距离
                businessDetailObj.getScreen($(this));
            });
            $(".features span").on("click", function() { //特性
                businessDetailObj.getScreen($(this));
            });
            //点击重置
            $("#repeat_btn").on("click", function() {
                $(".pigeon_tag span").removeClass("active");
            });
            //点击筛选弹窗确定
            $("#SX_sure_btn").on("click", function() {
                $(".SX_mark").css("transform", "translateX(0%)");
                $(".bg").hide();
                var tagArr = new Array();
                $(".pigeon_tag .active").each(function(i) {
                    var tagStr = $(".pigeon_tag .active").eq(i).html();
                    tagArr.push(tagStr);
                })
                pigeonStr = ""; //默认清空，重新渲染列表数据
                $("#list_view_box").html("");
                businessDetailObj.pigeonTags = tagArr.join(","); //鸽子标签
                businessDetailObj.orderDesc = followUpFlag ? "" : "desc";
                pigeonPostData.orderBy = $("#nav_box .active").index() == 0 ? "publishedTime" : "follows"; //关注量
                pigeonPostData.pageNum = 1;
                businessDetailObj.getPigeonData(pigeonPostData, "list");
            });
            //点击筛选左侧边栏
            // $(".SX_left").on("click", function() {
            //     $(".bg").show();
            // });

            //点击橱窗视图图标
            $("#release_btn").on("click", function() {
                location.href = "business_detail_view.html?openid=" + openid + "&businessid=" + businessid;
            });
            //跳转鸽子详情页  拼接 “鸽子id”
            $("#list_view_box").on("click", "li", function() {
                var pigeonid = $(this).attr("pigeonId");
                location.href = "product_details.html?openid=" + openid + "&pigeonid=" + pigeonid + "&businessid=" + businessid + "&shopName=" + encodeURIComponent($("#banner_tit h5").html());
            });
            //tab点击事件
            $(".j_index").on("click", function() { //首页
                location.href = "../index.html?openid=" + openid;
            });
            $(".in_foot_type").on("click", function() { //分类
                location.href = "all_match_list.html?openid=" + openid;
            });
            $(".in_foot_me").on("click", function() { //我的
                location.href = "mine.html?openid=" + openid;
            });

            //点击 “商家简介”
            $("#business_introduce").on("click", function() {
                location.href = "business_introduce.html?openid=" + openid + "&businessid=" + businessid;
            });
            $(".bg").on("click",function(){
                $(".SX_mark").css("transform", "translateX(0%)");
                $(".bg").hide();
            });
        })
    </script>
</body>
<style>
    .bg{
        background:rgba(0,0,0,0.3);
        width: 100%;
        height: 100%;
        position: fixed;
        top: 0;
        left: 0;
        display: none;
        z-index: 11;
    }
</style>
</html>
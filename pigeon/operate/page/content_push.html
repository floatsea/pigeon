<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>内容推荐</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/content_push.css">
    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/ajaxfileupload.js"></script>
    <script src="../js/public.js"></script>
</head>

<body>
    <div>
        <div class="commod_tit">
        </div>
        <div class="commodity_box">
            <h5>内容推荐</h5>
            <!--轮播-->
            <div class="content_rem_box">
                <h3>轮播图设置 <span style="color:#ccc">仅支持gif、jpeg、png、bmp四种格式，大小不超过3.0MB</span></h3>
                <ul id="swiper_box">
                    <li>
                        <div class="input_info_tit clearfix">
                            <span>图片1</span>
                            <div class="content_file_box">
                                <div class="content_file">
                                    <img src="" alt="" class="loadImg">
                                    <input type="file" class="upImg" name="upfile">
                                </div>
                                <i class="j_del_img" style="display:none"></i>
                            </div>
                        </div>
                        <div class="input_info_tit clearfix">
                            <span>链接地址</span>
                            <input type="text" class="swiper_url">
                        </div>
                    </li>
                </ul>
                <div class="content_rem_btn j_add_img">
                    <button>+添加下一张</button>
                </div>
            </div>
            <!--商家-->
            <div class="content_rem_box">
                <div class="content_rem_so clearfix">
                    <span>商家推荐</span>
                    <div class="serch_box">
                        <input type="text" placeholder="搜索商家" id="businessKey" />
                        <img src="../image/classification.png" class="serch" id="search_business">
                    </div>
                </div>
                <ol class="content_rem_name clearfix" id="business_list">
                    <li class="active">
                        <span>乔.巴特斯</span>
                        <img src="../image/g1.png" class="set_bus" />
                        <img src="../image/close.png" class="del_bus" />
                    </li>
                    <li>
                        <span>比利时.龙吉尔</span>
                        <img src="../image/g1.png" class="set_bus" />
                        <img src="../image/close.png" class="del_bus" />
                    </li>
                </ol>
                <div class="content_rem_list" id="business_pigeon_list">
                    <table>
                        <thead>
                            <tr>
                                <td style="width:30%">产品名称</td>
                                <td style="width:30%">卖点</td>
                                <td>价格</td>
                                <td style="width:15%">操作</td>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- <tr>
                                <td>
                                    <div class="clearfix">
                                        <div>
                                            <img src="../image/cp.png" alt="">
                                        </div>
                                        <input type="text" placeholder="长距离赛手BE17-4244533" />
                                    </div>
                                </td>
                                <td>
                                    <input type="text" placeholder="独家呈现！血统优秀！" />
                                </td>
                                <td>¥<i>500.00</i></td>
                                <td class="operation">
                                    <span><img class="up" src="../image/up.png"></span>
                                    <span><img class="down" src="../image/down.png"></span>
                                    <span><img class="del" src="../image/close.png"></span>
                                </td>
                            </tr> -->
                        </tbody>
                    </table>
                    <table style="display:none;">
                        <thead>
                            <tr>
                                <td style="width:30%">产品名称</td>
                                <td style="width:30%">卖点</td>
                                <td>价格</td>
                                <td style="width:15%">操作</td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="clearfix">
                                        <div>
                                            <img src="../image/cp.png" alt="">
                                        </div>
                                        <input type="text" placeholder="长距离赛手BE17-4244533" />
                                    </div>
                                </td>
                                <td>
                                    <input type="text" placeholder="独家呈现！血统优秀！" />
                                </td>
                                <td>¥1888.00</td>
                                <td class="operation">
                                    <span><img src="../image/up.png"></span>
                                    <span><img src="../image/down.png"></span>
                                    <span><img src="../image/close.png"></span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!--广告位-->
            <div class="content_rem_box">
                <h3>广告位<span style="color:#ccc">仅支持gif、jpeg、png、bmp四种格式，大小不超过3.0MB</span></h3>
                <ul id="banner_box">
                    <li>
                        <div class="input_info_tit clearfix">
                            <span>图片1</span>
                            <div class="content_file_box">
                                <div class="content_file">
                                    <img src="" alt="" class="loadImg">
                                    <input type="file" class="upImg" name="upfile">
                                </div>
                                <i class="j_del_img" style="display:none"></i>
                            </div>
                        </div>
                        <div class="input_info_tit clearfix">
                            <span>链接地址</span>
                            <input type="text">
                        </div>
                    </li>
                </ul>
                <div class="content_rem_btn j_add_img">
                    <button>+添加下一张</button>
                </div>
            </div>
            <!--赛事-->
            <div class="content_rem_box">
                <div class="content_rem_so content_rem_gp clearfix">
                    <span>赛事推荐</span>
                    <div>
                        <button id="import_race">导入赛事</button>
                    </div>
                </div>
                <div class="user_cont pro_mana_cont content_rem_list">
                    <table>
                        <thead>
                            <tr>
                                <td style="width:30%">赛事名称</td>
                                <td style="width:30%">起止日期</td>
                                <td>公棚</td>
                                <td>奖金</td>
                                <td style="width:15%">操作</td>
                            </tr>
                        </thead>
                        <tbody id="race_box">
                            <!-- <tr>
                                <td>
                                    <div class="clearfix">
                                        2018第三届三关大奖赛
                                    </div>
                                </td>
                                <td>
                                    <p>2018-06-21起</p>
                                    <p>2018-06-21止</p>
                                </td>
                                <td>天津宇航赛鸽公棚</td>
                                <td>1000万</td>
                                <td class="operation">
                                     <span><img class="up" src="../image/up.png"></span>
                                    <span><img class="down" src="../image/down.png"></span>
                                    <span><img class="del" src="../image/close.png"></span>
                                </td>
                            </tr> -->
                        </tbody>
                    </table>
                </div>
            </div>
            <!--公棚-->
            <div class="content_rem_box">
                <div>
                    <div class="content_rem_so content_rem_gp clearfix">
                        <span>公棚推荐</span>
                        <div>
                            <button id="import_oneloft">导入公棚</button>
                        </div>
                    </div>
                    <div class="content_rem_list">
                        <table>
                            <thead>
                                <tr>
                                    <td style="width:30%">公棚</td>
                                    <td style="width:30%">成立日期</td>
                                    <!-- <td>位置</td> -->
                                    <td>类型</td>
                                    <td style="width:15%">操作</td>
                                </tr>
                            </thead>
                            <tbody id="oneloft_box">
                                <!-- <tr>
                                    <td>
                                        <div class="clearfix">
                                            天津宇航赛鸽公棚
                                        </div>
                                    </td>
                                    <td>
                                        <p>2018-06-21</p>
                                    </td>
                                    <td>天津</td>
                                    <td>春棚</td>
                                    <td class="operation">
                                        <span><img class="up" src="../image/up.png"></span>
                                        <span><img class="down" src="../image/down.png"></span>
                                        <span><img class="del" src="../image/close.png"></span>
                                    </td>
                                </tr> -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <button class="input_info_save" id="save_btn">保存</button>
        </div>
    </div>
    <!--修改商家-->
    <!-- <div class="business_mark" style="display:none;">
        <div class="business_mark_box">
            <div>
                <span>商家名称</span>
                <input type="text" />
            </div>
            <div class="btn_box">
                <button class="cancel_btn">取消</button>
                <button class="sure_btn">确定</button>
            </div>
        </div>
    </div> -->
    <!--鸽子列表-->
    <div class="pigeon_mark" style="display:none;">
        <div class="content_rem_list">
            <table>
                <thead>
                    <tr>
                        <td>
                            <!-- <input type="checkbox" id="sel_all">
                            <label for=""></label> -->
                        </td>
                        <td style="width:30%">产品名称</td>
                        <td style="width:30%">卖点</td>
                        <td>价格</td>
                        <!-- <td style="width:15%">操作</td> -->
                    </tr>
                </thead>
                <tbody id="pigeon_mark_list">
                    <tr pigeonId="11">
                        <td>
                            <input type="checkbox">
                            <label for=""></label>
                        </td>
                        <td>
                            <div class="clearfix">
                                <div>
                                    <img class="pigeon_img" src="../image/cp.png" alt="">
                                </div>
                                <span class="pigeon_name">长距离赛手 BE17-4244533</span>
                            </div>
                        </td>
                        <td>
                            <span class="pigeon_point">独家呈现！血统优秀！</span>
                        </td>
                        <td>¥ <i class="pigeon_price">1888.00</i></td>
                    </tr>
                </tbody>
            </table>
            <div class="public_footer clearfix">
                <ul class="clearfix" id="pigeon_page_btn">
                    <!-- <li class="active">1</li>
                    <li>2</li>
                    <li>3</li>
                    <li>4</li>
                    <li>5</li> -->
                </ul>
                <div>共<span id="pigeon_sum_num">0</span>条，每页显示<span>20</span>条</div>
            </div>
            <div class="editor_button">
                <button class="cancel" id="pigeon_mask_close">关闭</button>
                <button id="pigeon_mask_sure">确定</button>
            </div>
        </div>

    </div>
    <!--赛事列表-->
    <div class="match_mark" style="display:none;">
        <div class="user_cont pro_mana_cont content_rem_list">
            <table>
                <thead>
                    <tr>
                        <td></td>
                        <td style="width:30%">赛事名称</td>
                        <td style="width:30%">起止日期</td>
                        <td>公棚</td>
                        <td>奖金</td>
                    </tr>
                </thead>
                <tbody id="race_mark_list">
                    <tr>
                        <td>
                            <input type="checkbox">
                            <label for=""></label>
                        </td>
                        <td>
                            <div class="clearfix">
                                2018第三届三关大奖赛
                            </div>
                        </td>
                        <td>
                            <p>2018-06-21起</p>
                            <p>2018-06-21止</p>
                        </td>
                        <td>天津宇航赛鸽公棚</td>
                        <td>500万</td>
                    </tr>
                </tbody>
            </table>
            <div class="public_footer clearfix">
                <ul class="clearfix" id="race_page_btn">
                    <!-- <li class="active">1</li>
                    <li>2</li>
                    <li>3</li>
                    <li>4</li>
                    <li>5</li> -->
                </ul>
                <div>共<span id="race_sum_num">0</span>条，每页显示<span>20</span>条</div>
            </div>
            <div class="editor_button">
                <button class="cancel" id="race_mask_close">关闭</button>
                <button id="race_mask_sure">确定</button>
            </div>
        </div>
    </div>
    <!--公棚列表-->
    <div class="oneloft_mark" style="display:none;">
        <div class="content_rem_list">
            <table>
                <thead>
                    <tr>
                        <td></td>
                        <td style="width:30%">公棚</td>
                        <td style="width:30%">成立日期</td>
                        <!-- <td>位置</td> -->
                        <td>类型</td>
                    </tr>
                </thead>
                <tbody id="oneloft_mark_list">
                    <tr>
                        <td>
                            <input type="checkbox">
                            <label for=""></label>
                        </td>
                        <td>
                            <div class="clearfix">
                                天津宇航赛鸽公棚
                            </div>
                        </td>
                        <td>
                            <p>2018-06-21</p>
                        </td>
                        <!-- <td>河北保定</td> -->
                        <td>秋棚</td>
                    </tr>
                </tbody>
            </table>
            <div class="public_footer clearfix">
                <ul class="clearfix" id="oneloft_page_btn">
                    <!-- <li class="active">1</li>
                    <li>2</li>
                    <li>3</li>
                    <li>4</li>
                    <li>5</li> -->
                </ul>
                <div>共<span id="oneloft_sum_num">0</span>条，每页显示<span>20</span>条</div>
            </div>
            <div class="editor_button">
                <button class="cancel" id="oneloft_mask_close">关闭</button>
                <button id="oneloft_mask_sure">确定</button>
            </div>
        </div>
    </div>
    <script src="../js/content_push.js"></script>
    <script>
        //初始化 页面
        // 王云泽 让调客户端首页接口，pc端并获取不到 坐标
        var initData = {
            "location": "经纬度坐标"
        };
        contentObj.innitRequest(initData);
        /**
         * part1
         * 轮播 
         */
        //选择图片上传 
        $("#swiper_box, #banner_box").on("change", ".upImg", function() {
            var $this = $(this);
            var _index = $this.index();
            var input1 = $this.get(0);
            var imgDom = $this.prev().get(0);
            var thisId = $(this).attr("id");
            var postUrl = location.origin + '/ueditor?action=uploadimage';
            uploadRequest(postUrl, thisId, function(imgUrl) {
                imgDom.src = imgUrl;
            });
        });

        //点击 “+添加下一张”
        $("#swiper_box").next(".j_add_img").on("click", function() {
            contentObj.createImg($("#swiper_box"));
        });
        //点击 “删除” 按钮
        $("#swiper_box, #banner_box").on("click", ".j_del_img", function() {
            var $this = $(this);
            if ($(this).closest("ul").attr("id") == "swiper_box") {
                contentObj.delImg($("#swiper_box"), $this);
            } else {
                contentObj.delImg($("#banner_box"), $this);
            }
        });

        /**
         * part2 商家
         */
        //初始化 商家
        var businessData = {
            "keyword": "",
            "pageSize": "5",
            "pageNum": "1",
            "orderBy": "createdTime",
            "orderDesc": "desc"
        };
        $("#search_business").on("click", function() { //点击 “搜索 商家”
            businessData.keyword = $("#businessKey").val();
            contentObj.businessRequest(businessData);
        });
        //点击 切换商家
        $("#business_list").on("click", "li", function() {
            $("#business_list").find("li").removeClass("active");
            var _index = $(this).index();
            $("#business_pigeon_list").find("table").hide();
            $("#business_pigeon_list").find("table").eq(_index).show();
            $(this).addClass("active");
        });


        //点击 “删除商家”
        $("#business_list").on("click", ".del_bus", function(ev) {
            ev.stopPropagation();
            var _index = $(this).closest("li").index();
            //$("#business_list").find("li").addClass("active");
            // 删除商家
            $(this).closest("li").remove();
            //商家对应的鸽子列表
            $("#business_pigeon_list table").eq(_index).remove();
            $("#business_list").find("li").eq(0).trigger("click");

            if ($("#business_list li").length == 1) {
                $("#business_list li").find(".del_bus").hide();
            }
        });

        /**点击设置商家
         *  查询该商家对应的鸽子列表
         *  分页展示
         */
        var pigeonData = {
                "businessId": "",
                "keyword": "",
                "pageSize": "20",
                "pageNum": "1",
                "orderBy": "publishedTime",
                "orderDesc": "desc"
            }
            //点击设置 “商家” 展示对应 鸽子列表
        $("#business_list").on("click", ".set_bus", function(ev) {
            ev.stopPropagation();
            var _index = $(this).closest("li").index(); //锁定第几个商家
            pigeonData.businessId = $(this).closest("li").attr("businessId");
            contentObj.pigeonRequest(pigeonData);
            $(".pigeon_mark").attr({
                "_index": _index,
                "businessId": pigeonData.businessId
            }).show();
            $(".pigeon_mark").find("input[type=checkbox]").prop("checked", false);
        });

        //关闭遮罩
        $("#pigeon_mask_close").on("click", function() {
            $(".pigeon_mark").hide();
        });

        /**
         *选择蒙层中 鸽子
         *1、如果已经选择过了，不能二次选择
         */
        $("#pigeon_mark_list").on("click", "input[type=checkbox]", function() {
            //锁定第几个商家
            var $this = $(this);
            var _index = $this.closest(".pigeon_mark").attr("_index");
            var haveTr = $("#business_pigeon_list").find("table").eq(_index).find("tr");

            var checkPigeonId = $this.closest("tr").attr("pigeonId");
            haveTr.each(function(k) {
                if (checkPigeonId == haveTr.eq(k).attr("pigeonId")) {
                    myAlert.createBox("该鸽子已经在列表中！");
                    $this.prop("checked", false);
                    return false;
                }
            })

        });
        //点击商家 蒙层 确定 
        $("#pigeon_mask_sure").on("click", function() {
            // 锁定 第几个商家
            var _index = $(this).closest(".pigeon_mark").attr("_index");
            // 选中的鸽子
            var checkedPigeon = $("#pigeon_mark_list").find("input[type=checkbox]:checked");
            var checkPigeonArr = new Array();
            checkedPigeon.each(function(i) {
                var tr = checkedPigeon.eq(i).closest("tr");
                checkPigeonArr.push({
                    "pigeonImg": tr.find(".pigeon_img").attr("src"), //图片
                    "pigeonId": tr.attr("pigeonId"), // id
                    "pigeonUrl": "",
                    "pigeonName": tr.find(".pigeon_name").html().split(" ")[0], //鸽子名称
                    "pigeonNo": tr.find(".pigeon_name").html().split(" ")[1], // 鸽子编号
                    "pigeonPrice": tr.find(".pigeon_price").html(), //价格
                    "pigeonDesc": tr.find(".pigeon_point").html() // 卖点
                });
            });
            //选中的鸽子列表 字符
            var pigeonStr = contentObj.createPigeonList(checkPigeonArr);
            $("#business_pigeon_list").find("table").eq(_index).find("tbody").append(pigeonStr);
            $("#business_pigeon_list").find("table").eq(_index).show();
            $(".pigeon_mark").hide();
        });

        //点击 鸽子列表 上移动按钮
        $("#business_pigeon_list").on("click", ".up", function() {
            var $this = $(this).closest("tr");
            domMove("up", $this);
        });
        //点击 鸽子列表 下移动按钮
        $("#business_pigeon_list").on("click", ".down", function() {
            var $this = $(this).closest("tr");
            domMove("down", $this);
        });
        //点击 删除 鸽子列表
        $("#business_pigeon_list").on("click", ".del", function() {
            var $this = $(this);
            $this.closest("tr").remove();
            var trlen = $("#business_pigeon_list").find("tr").length;
            if (trlen == 0) {
                $this.closest("table").hide();
            }
        });
        /***********************************鸽子列表结束***************************************/
        /*点击 “页码”
         * 重新获取数据
         */
        $("#pigeon_page_btn").delegate("li", "click", function() {
            $("#pigeon_page_btn").find("li").removeClass("active");
            $(this).addClass("active");
            pigeonData.pageNum = $(this).index();
            //重新获取列表 （调后端接口）
            contentObj.pigeonRequest(pigeonData);
        });

        /**
         * part3 广告位
         */
        //点击 “+添加下一张”
        $("#banner_box").next(".j_add_img").on("click", function() {
            contentObj.createImg($("#banner_box"));
        });
        /**
         * part4 赛事
         */
        //导入赛事
        var raceData = {
            "keyword": "",
            "pageSize": "5",
            "pageNum": "1",
            "orderBy": "publishedTime",
            "orderDesc": "desc"
        };
        $("#import_race").on("click", function() {
            contentObj.raceListRequest(raceData);
            $(".match_mark").show();
            $(".match_mark").find("input[type=checkbox]").prop("checked", false);
        });



        /*点击 “页码”
         * 重新获取数据
         */
        $("#race_page_btn").delegate("li", "click", function() {
            $("#race_page_btn").find("li").removeClass("active");
            $(this).addClass("active");
            raceData.pageNum = $(this).index();
            //重新获取列表 （调后端接口）
            contentObj.raceListRequest(raceData);
        });
        /**
         *选择蒙层中 赛事
         *1、如果已经选择过了，不能二次选择
         */
        $("#race_mark_list").on("click", "input[type=checkbox]", function() {
            var $this = $(this);
            var haveTr = $("#race_box").find("tr");

            var checkPigeonId = $this.closest("tr").attr("raceId");
            haveTr.each(function(k) {
                if (checkPigeonId == haveTr.eq(k).attr("raceId")) {
                    myAlert.createBox("该赛事已经在列表中！");
                    $this.prop("checked", false);
                    return false;
                }
            })
        });
        //点击赛事 蒙层 确定 
        $("#race_mask_sure").on("click", function() {
            // 选中的鸽子
            var checkedRace = $("#race_mark_list").find("input[type=checkbox]:checked");
            var checkArr = new Array();
            checkedRace.each(function(i) {
                var tr = checkedRace.eq(i).closest("tr");
                checkArr.push({
                    "raceId": tr.attr("raceId"),
                    "raceName": tr.find(".race_tit").html(),
                    "oneloftName": tr.find(".oneloft_name").html(),
                    "startedTime": tr.find(".started_time").html(),
                    "endedTime": tr.find(".ended_time").html(),
                    "enrolledTime": tr.find(".ended_time").attr("enrolledTime"),
                    "reward": tr.find(".reward").html()
                });
            });
            //选中的赛事列表 字符
            var str = contentObj.createRace(checkArr);
            $("#race_box").append(str);
            $(".match_mark").hide();
        });

        //关闭遮罩
        $("#race_mask_close").on("click", function() {
            $(".match_mark").hide();
        });

        //点击 赛事列表 上移动按钮
        $("#race_box").on("click", ".up", function() {
            var $this = $(this).closest("tr");
            domMove("up", $this);
        });
        //点击 赛事列表 下移动按钮
        $("#race_box").on("click", ".down", function() {
            var $this = $(this).closest("tr");
            domMove("down", $this);
        });
        // 点击 赛事列表 删除
        $("#race_box").on("click", ".del", function() {
            var $this = $(this);
            $this.closest("tr").remove();
            var trlen = $("#race_box").find("tr").length;
            if (trlen == 0) {
                $this.closest("table").hide();
            }
        });
        /************************************赛事结束****************************/
        /**
         * part5 公棚
         */
        var oneloftData = {
            "keyword": "",
            "pageSize": "5",
            "pageNum": "1",
            "orderBy": "publishedTime",
            "orderDesc": "desc"
        };
        $("#import_oneloft").on("click", function() {
            oneloftData.pageSize = "";
            oneloftData.pageNum = "";
            contentObj.oneloftRequest(oneloftData);
            $(".oneloft_mark").show();
            $(".oneloft_mark").find("input[type=checkbox]").prop("checked", false);
        });

        // 点击 公棚分页
        $("#oneloft_page_btn").delegate("li", "click", function() {
            $("#oneloft_page_btn").find("li").removeClass("active");
            $(this).addClass("active");
            oneloftData.pageNum = $(this).index();
            //重新获取列表 （调后端接口）
            contentObj.oneloftRequest(oneloftData);
        });
        /**
         *选择蒙层中 公棚
         *1、如果已经选择过了，不能二次选择
         */
        $("#oneloft_mark_list").on("click", "input[type=checkbox]", function() {
            var $this = $(this);
            var haveTr = $("#oneloft_box").find("tr");

            var checkPigeonId = $this.closest("tr").attr("oneloftId");
            haveTr.each(function(k) {
                if (checkPigeonId == haveTr.eq(k).attr("oneloftId")) {
                    myAlert.createBox("该公棚已经在列表中！");
                    $this.prop("checked", false);
                    return false;
                }
            })
        });
        //点公棚 蒙层 确定 
        $("#oneloft_mask_sure").on("click", function() {
            // 选中的鸽子
            var checkedOneloft = $("#oneloft_mark_list").find("input[type=checkbox]:checked");
            var checkArr = new Array();
            checkedOneloft.each(function(i) {
                var tr = checkedOneloft.eq(i).closest("tr");
                checkArr.push({
                    "oneloftId": tr.attr("oneloftId"),
                    "oneloftName": tr.find(".oneloftName").html(),
                    "establishTime": tr.find(".establishTime").html(),
                    "provinceCode": tr.find(".cityCode").attr("provinceCode"),
                    "cityCode": tr.find(".cityCode").html(),
                    "oneloftType": tr.find(".oneloftType").attr("oneloftType"),
                    "location": tr.attr("location"),
                    "distance": tr.attr("distance")

                });
            });
            //选中的鸽子列表 字符
            var str = contentObj.createOneloft(checkArr);
            $("#oneloft_box").append(str);
            $(".oneloft_mark").hide();
        });
        //点击蒙层 关闭
        $("#oneloft_mask_close").on("click", function() {
            $(".oneloft_mark").hide();
        });

        //点击 公棚列表 上移动按钮
        $("#oneloft_box").on("click", ".up", function() {
            var $this = $(this).closest("tr");
            domMove("up", $this);
        });
        //点击 公棚列表 下移动按钮
        $("#oneloft_box").on("click", ".down", function() {
            var $this = $(this).closest("tr");
            domMove("down", $this);
        });
        // 点击 公棚列表 删除
        $("#oneloft_box").on("click", ".del", function() {
            var $this = $(this);
            $this.closest("tr").remove();
            var len = $("#oneloft_box").find("tr").length;
            if (len == 0) {
                $this.closest("table").hide();
            }
        });
        /*--------------------------------交互结束-----------------------------------*/
        //保存
        $("#save_btn").on("click", function() {
            //轮播
            var slideshowArr = [];
            $("#swiper_box li").each(function(i) {
                var liDom = $("#swiper_box li").eq(i)
                slideshowArr.push({
                    "img": liDom.find(".loadImg").attr("src"),
                    "url": liDom.find(".swiper_url").val(),
                    "alt": "",
                    "desc": ""
                });
            });
            //商品
            var businessArr = [];
            var businessList = $("#business_list li");
            businessList.each(function(i) {
                var thisTable = $("#business_pigeon_list").find("table").eq(i);
                var thisTrList = thisTable.find("tbody").find("tr");
                var pigeonArr = new Array();
                thisTrList.each(function(j) {
                    pigeonArr.push({ //数据结构有问题，待确认
                        "pigeonImg": thisTrList.eq(j).find(".pigeonImg").attr("src"),
                        "pigeonUrl": "javascript:;",
                        "pigeonId": thisTrList.eq(j).attr("pigeonId"),
                        "pigeonName": thisTrList.eq(j).find(".pigeonName").val().split(" ")[0],
                        "pigeonNo": thisTrList.eq(j).find(".pigeonName").attr("pigeonNo"),
                        "pigeonPrice": thisTrList.eq(j).find(".pigeonPrice").html(),
                        "pigeonDesc": thisTrList.eq(j).find(".pigeonDesc").val()
                    });
                })
                var busiData = {
                    "businessId": businessList.eq(i).attr("businessId"),
                    "shopName": businessList.eq(i).find("span").html(),
                    "pigeonCount": businessList.eq(i).attr("pigeonCount"),
                    "pigeons": pigeonArr
                };
                businessArr.push(busiData);
            });
            //广告位
            var bannerArr = [];
            $("#banner_box li").each(function(i) {
                var liDom = $("#banner_box li").eq(i)
                bannerArr.push({
                    "img": liDom.find(".loadImg").attr("src"),
                    "url": liDom.find(".swiper_url").val(),
                    "alt": "",
                    "desc": ""
                });
            });
            //赛事
            var raceList = $("#race_box tr");
            var raceArr = [];
            raceList.each(function(i) {
                raceArr.push({
                    "raceId": raceList.eq(i).attr("raceId"),
                    "raceName": raceList.eq(i).find(".race_tit").html(),
                    "oneloftName": raceList.eq(i).find(".oneloft_name").html(),
                    "startedTime": raceList.eq(i).find(".started_time").html(),
                    "endedTime": raceList.eq(i).find(".ended_time").html(),
                    "enrolledTime": raceList.eq(i).find(".ended_time").attr("enrolledTime"),
                    "reward": raceList.eq(i).find(".reward").html()
                })
            });
            //公棚
            var oneloftList = $("#oneloft_box tr");
            var oneloftArr = [];
            oneloftList.each(function(i) {
                oneloftArr.push({
                    "oneloftId": oneloftList.eq(i).attr("oneloftId"),
                    "oneloftName": oneloftList.eq(i).find(".oneloft_name").html(),
                    "establishTime": oneloftList.eq(i).find(".establishTime").html(),
                    "provinceCode": oneloftList.eq(i).find(".cityCode").attr("provinceCode"),
                    "cityCode": oneloftList.eq(i).find(".cityCode").html(),
                    "oneloftType": oneloftList.eq(i).find(".oneloftType").attr("oneloftType"),
                    "location": oneloftList.eq(i).attr("location"),
                    "distance": oneloftList.eq(i).attr("distance")
                })
            });
            var saveData = {
                list: [
                    //轮播图
                    {
                        "configId": $("#swiper_box").attr("configId"),
                        "configCategory": "slideshow",
                        "configValue": {
                            "images": slideshowArr
                        }
                    },
                    //商品
                    {
                        "configId": $("#business_list").attr("configId"),
                        "configCategory": "pigeon",
                        "configValue": {
                            "businesses": businessArr
                        }
                    },
                    // 广告位：
                    {
                        "configId": $("#banner_box").attr("configId"),
                        "configCategory": "advertisment",
                        "configValue": {
                            "images": bannerArr
                        }
                    },
                    //赛事推荐： 
                    {
                        "configId": $("#race_box").attr("configId"),
                        "configCategory": "race",
                        "configValue": {
                            "races": raceArr
                        }
                    },
                    //公棚
                    {
                        "configId": $("#oneloft_box").attr("configId"),
                        "configCategory": "oneloft",
                        "configValue": {
                            "onelofts": oneloftArr
                        }
                    }
                ]
            }
            contentObj.saveRequest(saveData);
        });
    </script>
</body>

</html>
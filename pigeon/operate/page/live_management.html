<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>直播管理</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/public.js"></script>
</head>

<body>
    <div>
        <div class="public_tit" id="live_tit">
            <span class="active">已发布</span>
            <span>待发布</span>
        </div>
        <div class="public_box" id="product_cont">
            <div>
                <div class="user_top">
                    <!-- <p class="quick_search">快速检索</p> -->
                    <div class="user_top_cont clearfix">
                        <div class="user_top_cont_l">
                            <span>直播名称：</span>
                            <input type="text" placeholder="输入直播名称">
                            <button>查询</button>
                        </div>
                        <div class="product_button" id="title_btn">
                            <div>
                                <button id="del_button">删除</button>
                            </div>
                            <div style="display:none;">
                                <button>审核通过</button>
                                <button>拒审</button>
                                <button>删除</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="user_cont" id="live_mana_cont">
                    <table>
                        <thead>
                            <tr>
                                <td>
                                    <input type="checkbox" id="sel_all_already">
                                    <label for=""></label>
                                </td>
                                <td>标题时长</td>
                                <td>发布日期</td>
                                <td>编辑</td>
                                <td>公棚</td>
                                <td>操作</td>
                            </tr>
                        </thead>
                        <tbody id="waiting_cont">
                            <tr>
                                <td>
                                    <input type="checkbox">
                                    <label for=" "></label>
                                </td>
                                <td>
                                    <div style="line-height:90px;">
                                        比利时亚精顿！国家赛[00:01:20]
                                    </div>
                                </td>
                                <td>2018-06-28 18:08</td>
                                <td>133****6456</td>
                                <td>天津宇航赛鸽公棚</td>
                                <td>
                                    <span class="editor_btn">查看详情</span> |
                                    <span class="del_btn">删除</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table style="display:none">
                        <thead>
                            <tr>
                                <td>
                                    <input type="checkbox" id="sel_all_waiting">
                                    <label for=""></label>
                                </td>
                                <td>标题</td>
                                <td>申请日期</td>
                                <td>编辑</td>
                                <td>公棚</td>
                                <td>状态</td>
                                <td>操作</td>
                            </tr>
                        </thead>
                        <tbody id="already_cont">
                            <tr>
                                <td>
                                    <input type="checkbox">
                                    <label for=""></label>
                                </td>
                                <td>
                                    <div style="line-height:90px;">
                                        比利时亚精顿！国家赛
                                    </div>
                                </td>
                                <td>2018-06-28 18:08</td>
                                <td>133****6456</td>
                                <td>天津宇航赛鸽公棚</td>
                                <td>已审核</td>
                                <td>
                                    <span class="editor_btn">回放</span> |
                                    <span class="del_btn">删除</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="public_footer clearfix" id="page_btn">
                    <ul class="clearfix">
                        <li class="active">1</li>
                        <li>2</li>
                        <li>3</li>
                        <li>4</li>
                        <li>5</li>
                    </ul>
                    <div>共<span id="total_num">100</span>条，每页显示<span>20</span>条</div>
                </div>
            </div>
        </div>
    </div>
    <script src="../js/product_management.js"></script>
    <script>
        //切换 "已发布 "、"待发布 "
        $("#live_tit span ").on("click", function() {
            $("#sel_all ").prop("checked", false);
            var _index = $(this).index();
            $("#live_tit span ").removeClass("active");
            $(this).addClass("active");

            // 标题按钮变化
            $("#title_btn").find("div").hide();
            $("#title_btn").find("div").eq(_index).show();

            //内容切换
            $("#live_mana_cont table").hide();
            $("#live_mana_cont table").eq(_index).show();
        });

        //点击 “页码”
        $("#page_btn").delegate("li", "click", function() {
            $("#page_btn").find("li").removeClass("active");
            $(this).addClass("active");
            proListData.keyword = $("#Keyword").val();
            proListData.pageNum = $(this).index();
            //重新获取列表 （调后端接口）
            productObj.proListRequst(proListData)
        });
        //点击“全选”
        $("#sel_all_already, #sel_all_waiting").on("change", function() {
            var selAllFlag = $(this).prop("checked");
            if (selAllFlag) {
                $(this).closest("table").find("tbody").find("input[type=checkbox]").prop("checked", true);
            } else {
                $(this).closest("table").find("tbody").find("input[type=checkbox]").prop("checked", false);
            }
        });


        //点击列表中“checkbox”
        $("#pro_list_box").on("change", "input[type=checkbox]", function() {
            if ($("#pro_list_box").find("input:checked").length > 0) {
                $(".product_button button").addClass("active");
            } else {
                $(".product_button button").removeClass("active");
            }
            if ($("#pro_list_box").find("input:checked").length == $("#pro_list_box").find(
                    "input[type=checkbox]").length) {
                $("#sel_all").prop("checked", true);
            } else {
                $("#sel_all").prop("checked", false);
            }
        });
        //点击 "编辑 " 产品
        $("#pro_list_box").on("click", ".editor_btn", function() {
            var pigeonId = $(this).closest("tr").attr("pigeonId");
            var businessId = $(this).closest("tr").attr("businessId");
            location.href = "product_editor.html?pigeonId=" + pigeonId + " &businessId=" + businessId;
        });
        //点击 “删除”
        $(" #pro_list_box").on("click ", ".del_btn", function() {
            var $this = $(this);
            var delData = {
                "pigeonId ": $this.closest("tr").attr("pigeonId"), //"鸽子id：支持多个，逗号,分隔 ",

            };
            productObj.deleteList(delData, function() {
                $this.closest("tr").remove();
            })
        });
        //点击 “删除” 大按钮
        $("#del_button").on("click", function() {
            if ($(this).hasClass("active ")) {
                var checkPigeon = $("#pro_list_box").find("input[type=checkbox]:checked");
                var pigeonArr = [];
                checkPigeon.each(function(index) {
                    pigeonArr.push(checkPigeon.eq(index).closest("tr").attr("pigeonId"))
                });
                var delData = {
                    "pigeonId": pigeonArr.join(",") //"鸽子id：支持多个，逗号,分隔 ",
                };
                //调 “删除” 接口 成功后 重新获取数据
                productObj.deleteList(delData, function() {
                    checkPigeon.closest("tr").remove();
                    proListData.pageNum = $("#page_btn").find(".active").html();
                })
            }
        });
    </script>
</body>
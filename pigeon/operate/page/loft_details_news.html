<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>公棚动态</title>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,target-densitydpi=medium-dpi">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/loft_about.css">
    <script type="text/javascript" src="../js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="../js/public.js"></script>
    <script type="text/javascript" src="../js/weixin_init.js"></script>
    <style lang="">

    </style>
</head>

<body>
    <div class="loft_news_box">
        <h3>公棚动态</h3>
        <ul class="list_box" id="news_list_box">
            <li>
                300公里开龙信息及照片信息
            </li>
            <li>
                300公里开龙信息及照片信息
            </li>
            <li>
                300公里开龙信息及照片信息
            </li>
        </ul>
        <!--上拉加载更多-->
        <div class="load_more">
            <img src="../image/load.gif" alt="" style="display:none;">
            <span id="load_more_txt">上拉加载更多</span>
        </div>
    </div>
    <script>
        var openid = getParameter("openid") || "";
        var oneloftid = getParameter("oneloftid") || ""; //公棚id
        var scrollFlag = true; //上拉加载更多标志
        var postNewsData = {
            "publisher_id": oneloftid, //商家id或公棚id
            "news_type": "oneloft", //消息类型：商家，business；公棚oneloft"
            "pageSize": "10",
            "pageNum": "1"
        };
        getLoftNews(postNewsData);
        //公棚资讯列表
        function getLoftNews(postNewsData) {
            $.ajax({
                url: location.origin + "/customer/news/findList",
                type: "post",
                data: JSON.stringify(postNewsData),
                dataType: "json",
                contentType: "application/json",
                success: function(data) {
                    
                    if (data.code == "0") {
                        var list = data.data.list;
                        createLoftNews(list);
                        scrollFlag = data.data.hasNextPage;
                        if (!scrollFlag) {
                            $(".load_more img").hide();
                            $("#load_more_txt").html("没有更多数据");
                        } else {
                            $(".load_more img").hide();
                            $("#load_more_txt").html("上拉加载更多");
                        }
                    }
                },
                error: function() {
                    myAlert.createBox("服务器开小差！")
                }
            })
        }
        //创建公棚列表
        function createLoftNews(list) {
            var newsStr = "";
            list.forEach(function(val) {
                newsStr += '<li>' + val.newsTitle + '</li>';
            });
            $("#news_list_box").html(newsStr);
        }
        //滚动事件
        $(window).on("scroll", function() {
            var scrolT = $(document).scrollTop(); //滚动距离
            var clientH = $(window).height(); //视口高度
            var allH = $(document).height(); //整个文档高度
            if (allH - clientH <= scrolT && scrolT > 20) {
                if (scrollFlag) {
                    scrollFlag = false;
                    $(".load_more img").show();
                    $("#load_more_txt").html("加载中...");
                    postNewsData.pageNum += 1; //页码
                    setTimeout(function() {
                        getLoftNews(postNewsData);
                        $(document).scrollTop(scrolT - 10);
                    }, 1500);
                }
            }
        });
    </script>
</body>

</html>
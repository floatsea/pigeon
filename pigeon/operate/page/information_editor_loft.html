<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>信息管理</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/m_style.css">
    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/public.js"></script>
    <script type="text/javascript" charset="utf-8" src="/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="/ueditor/ueditor.all.min.js">
    </script>
    <script type="text/javascript" charset="utf-8" src="/ueditor/lang/zh-cn/zh-cn.js"></script>
</head>

<body>
    <div>
        <div class="commod_tit" id="order_tit">
            <span>录入资讯</span>
        </div>
        <div class="commodity_box">
            <div class="input_info_tit clearfix">
                <span>公棚</span>
                <input type="text" placeholder="" id="oneloftName">
            </div>
            <div class="input_info_tit clearfix">
                <span>标题</span>
                <input type="text" placeholder="" id="newsTitle">
                <p class="warn">
                    <i class="iconfont red icon-tixingshixin"></i>请填写资讯标题
                </p>
            </div>
            <div class="input_info_cont clearfix">
                <span>
                    资讯详情
                </span>
                <div class="input_info_txt">
                    <script id="editor" type="text/plain" style="width:100%; height:300px"></script>
                </div>
            </div>
            <div class="editor_button">
                <button class="return_button">返回</button>
                <button class="save_button">保存</button>
            </div>
        </div>
    </div>
    <script src="../js/information_editor.js"></script>
    <script>
        var ue = UE.getEditor('editor');
        var newsId = getParameter("newsId") || ""; //有值：编辑 否则 “录入资讯” 进来的
        if (oneloftName) {
            $("#oneloftName").attr("readonly", "readonly");
            $("#oneloftName").val(oneloftName);
        } else {
            $("#oneloftName").attr("readonly", "");
            $("#oneloftName").val("");
        }
        if (newsId) {
            var newsData = {
                "newsId": newsId //资讯id
            }
            inforEditor.initRequest(newsData);
            $("#newsTitle").next().hide();
        } else {
            $("#newsTitle").next().show();
        }
        //校验信息完整度
        function isInputText() {
            var inputText = $("input[type=text]"); //所有输入框
            for (var i = 0; i < inputText.length; i++) {
                if (inputText.eq(i).val() == "") {
                    return false;
                }
            }
            return true;
        }
        // 返回
        $(".return_button").on("click", function() {
            window.history.go(-1);
        });
        // 保存
        $(".save_button").on("click", function() {
            if (!isInputText()) {
                myAlert.createBox("信息填写不完整！");
                return;
            }
            if (newsId) {
                var saveData = {
                    "newsContent": ue.getContent(), //"资讯内容",
                    "newsId": newsId,
                    "newsTitle": $("#newsTitle").val(),
                };
                inforEditor.saveInfor(saveData, function() {
                    window.history.go(-1);
                });
            } else {
                var saveData = {
                    "newsContent": ue.getContent(), //"资讯内容", 富文本
                    "oneloftName": $("#oneloftName").val(),
                    "newsTitle": $("#newsTitle").val(),
                    "ownerType": 2, //"资讯类型：商家：1，公棚：2",
                    "ownerId": oneloftId //归属id,
                }
                inforEditor.addInfor(saveData, function() {
                    window.history.go(-1);
                });
            }
        });
        $("#newsTitle").on("keyup", function() {
            if (!$(this).val()) {
                $(this).closest("div").find(".warn").show();
            } else {
                $(this).closest("div").find(".warn").hide();
            }
        });
    </script>
</body>

</html>
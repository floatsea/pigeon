<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>公棚</title>
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,target-densitydpi=medium-dpi">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/m_style.css" />
    <link rel="stylesheet" href="../css/mobileSelect.css" />
</head>

<body>
    <div>
        <div class="loft_search clearfix">
            <div class="loft_search_l">
                <span id="trigger1">公棚</span>
                <img src="../image/gp.png">
            </div>
            <div class="loft_search_r">
                <input type="text" placeholder="唐山天翼盛翔赛鸽公棚">
                <img src="../image/search_gp.png">
            </div>
        </div>
        <!--导航-->
        <div class="navigation_box">
            <ul class="navigation clearfix" id="nav_box">
                <li class="active">
                    <div class="new_release_r">最新发布</div>
                    <div class="el_but" id="new_updown">
                        <img src="../image/sj_icon0.png" alt="">
                    </div>
                </li>
                <li>
                    <div class="new_release_r">人气</div>
                    <div class="el_but" id="follow_updown">
                        <img src="../image/sj_icon0.png" alt="">
                    </div>
                </li>
            </ul>
            <p class="line_red"></p>
        </div>
        <!--内容-->
        <div style="padding-bottom:4rem">
            <ul class="loft_search_cn" id="loft_list_box">
                <!-- <li class="clearfix paddingB">
                <div class="loft_search_cnl">
                    <img src="../image/gongpeng.png">
                </div>
                <div class="loft_search_cnr">
                    <p class="cnr_name">天津镖行天下赛鸽公棚</p>
                    <p class="cnr_c">
                        <span class="cnr_Introduction">秋鹏</span>
                        <span class="cnr_time">成立4年</span>
                    </p>
                    <p class="cnr_location">
                        <img src="../image/dinw.png">
                        <span>天津市 距离124km</span>
                    </p>
                </div>
            </li> -->
            </ul>
            <!--上拉加载更多-->
            <div class="load_more" style="padding:0.5rem 0">
                <img src="../image/load.gif" alt="" style="display:none; top:.3rem;">
                <span id="load_more_txt">上拉加载更多</span>
            </div>
        </div>
        <!--tab栏-->
        <footer class="in_foot">
            <ul>
                <li class="j_index">
                    <img src="../image/header.png" alt="">
                    <p>首页</p>
                </li>
                <li class="j_breeding">
                    <img src="../image/dove.png" alt="">
                    <p>种鸽</p>
                </li>
                <li class="in_foot_type">
                    <img src="../image/classification2.png" alt="">
                    <p style="color:#ff0913">分类</p>
                </li>
                <li class="in_foot_me">
                    <img src="../image/me2.png" alt="">
                    <p>我的</p>
                </li>
            </ul>
        </footer>
    </div>
    <script type="text/javascript" src="../js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="../js/public.js"></script>
    <script type="text/javascript" src="../js/weixin_init.js"></script>
    <script type="text/javascript" src="../js/mobileSelect.min.js"></script>
    <script type="text/javascript" src="../json/indexJson.js"></script>
    <script type="text/javascript" src="../js/all_loft_list.js?v=0"></script>
    <script>
        $(function() {
            //注：orderBy可选字段：createdTime添加时间，publishedTime添加时间，updatedTime修改时间，views浏览量，sales销量，follows关注量.
            var postLoftData = {
                "location": locationStr, //经纬度
                "keyword": "", //检索关键字
                "pageSize": "5", //
                "pageNum": 1,
                "orderBy": "publishedTime",
                "orderDesc": "" //分页参数：升降序标记，desc为降序，不传或空字符串为升序
            }
            loftListObj.initLostQuest(postLoftData); //页面初始化

            //屏幕滚动事件
            var scrollFlag = true;
            $(window).on("scroll", function() {
                var scrolT = $(document).scrollTop(); //滚动距离
                var clientH = $(window).height(); //视口高度
                var allH = $(document).height(); //整个文档高度
                if (allH - clientH <= scrolT && scrolT > 20) {
                    if (scrollFlag) {
                        scrollFlag = false;
                        $(".load_more img").show();
                        $("#load_more_txt").html("加载中...")
                        postLoftData.orderBy = $("#nav_box .active").index() == 0 ? "publishedTime" : "follows"; //关注量
                        postLoftData.pageNum += 1; //页码
                        setTimeout(function() {
                            loftListObj.initLostQuest(postLoftData);
                            $(document).scrollTop(scrolT - 10);
                        }, 1500)
                    }
                }
            });
            /*-----------------------------点击事件-------------------------*/
            //点击 最新发布 、人气
            var lineL = parseFloat($(".line_red").css("left"));
            $("#nav_box li").on("click", function() {
                var _index = $(this).index();
                $("#nav_box li").removeClass("active");
                $(this).addClass("active");

                switch (_index) {
                    case 0:
                        $(".line_red").css({
                            "left": (lineL + $(".line_red").width() / 2) + "px",
                            "transition": "left 0.3s"
                        });
                        postLoftData.orderBy = "publishedTime";
                        break;
                    case 1:
                        var L = $("#nav_box li").eq(0).width() + $(".line_red").width() + lineL / 3;
                        $(".line_red").css({
                            "left": L + "px",
                            "transition": "left 0.3s"
                        });
                        postLoftData.orderBy = "follows";
                }
                loftListStr = "";
                $("#loft_list_box").html("");
                postLoftData.pageNum = 1;
                loftListObj.initLostQuest(postLoftData);
            });
            //点击 “最新发布” 排序
            //默认升序
            var newUpFlag = true;
            $("#new_updown img").on("click", function(ev) {
                ev.stopPropagation();
                newUpFlag = !newUpFlag;
                var upImg = newUpFlag ? "../image/sj_icon0.png" : "../image/sj_icon.png";
                $(this).attr("src", upImg);
                //调接口
                loftListStr = "";
                $("#loft_list_box").html("");
                postLoftData.pageNum = 1;
                postLoftData.orderDesc = newUpFlag ? "" : "desc";
                postLoftData.orderBy = "publishedTime";
                loftListObj.initLostQuest(postLoftData);
            });
            //点击 “人气” 排序
            var followUpFlag = true;
            $("#follow_updown img").on("click", function(ev) {
                ev.stopPropagation();
                followUpFlag = !followUpFlag;
                var upImg = followUpFlag ? "../image/sj_icon0.png" : "../image/sj_icon.png";
                $(this).attr("src", upImg);
                //调接口
                loftListStr = "";
                $("#loft_list_box").html("");
                postLoftData.pageNum = 1;
                postLoftData.orderDesc = newUpFlag ? "" : "desc";
                postLoftData.orderBy = "follows";
                loftListObj.initLostQuest(postLoftData);
            });

            /*点击事件*/
            $(".j_index").on("click", function() { //首页
                location.href = "../index.html?openid=" + openid;
            });
            $(".j_breeding").on("click", function() { //种鸽
                location.href = "business_list.html?openid=" + openid;
            });
            $(".in_foot_me").on("click", function() { //我的
                location.href = "mine.html?openid=" + openid;
            });

            /*公棚详情*/
            $(".loft_search_cn").on("click", "li", function() {
                location.href = "loft_details.html?openid=" + openid + "&oneloftid=" + $(this).attr("oneloftId");
            });
            /*跳转赛事*/
            var mobileSelect1 = new MobileSelect({
                trigger: '#trigger1',
                title: '',
                wheels: [{
                    data: [
                        "公棚",
                        "赛事"
                    ]
                }],
                position: [0], //初始化定位 打开时默认选中的哪个 如果不填默认为0
                transitionEnd: function(indexArr, data) {

                },
                callback: function(indexArr, data) {
                    if (data == "赛事") {
                        location.href = "all_match_list.html?openid=" + openid;
                    }
                }
            });
        })
    </script>
</body>

</html>